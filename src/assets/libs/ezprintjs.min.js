'use strict';var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}(function(window,document){function isIE(){return'ActiveXObject'in window}function enableImportNode(doc){if(!doc.ELEMENT_NODE){doc.ELEMENT_NODE=1;doc.ATTRIBUTE_NODE=2;doc.TEXT_NODE=3;doc.CDATA_SECTION_NODE=4;doc.ENTITY_REFERENCE_NODE=5;doc.ENTITY_NODE=6;doc.PROCESSING_INSTRUCTION_NODE=7;doc.COMMENT_NODE=8;doc.DOCUMENT_NODE=9;doc.DOCUMENT_TYPE_NODE=10;doc.DOCUMENT_FRAGMENT_NODE=11;doc.NOTATION_NODE=12}doc._importNode=function(node,allChildren){switch(node.nodeType){case doc.ELEMENT_NODE:var newNode=doc.createElement(node.nodeName);if(node.attributes&&node.attributes.length>0)Array.from(node.attributes).forEach(function(attr){return newNode.setAttribute(attr.nodeName,attr.value)});if(allChildren&&node.childNodes&&node.childNodes.length>0)Array.from(node.childNodes).forEach(function(childNode){return newNode.appendChild(doc._importNode(childNode,allChildren))});return newNode;break;case doc.COMMENT_NODE:return doc.createComment(node.nodeValue);break;case doc.TEXT_NODE:case doc.CDATA_SECTION_NODE:return doc.createTextNode(node.nodeValue);break;}}}function ezCtrlP(options){var attachListener=function attachListener(e){if(e.ctrlKey&&e.key.toLowerCase()==='p'){e.preventDefault();window.ezPrintJS(options)}};if(window.addEventListener)window.addEventListener('keydown',attachListener);else window.addEvent('onkeydown',attachListener)}var tagHandlerMap={'*':[removeInlineStyles,revealHiddenEl,extendScrollable,hideSpottedEl],'A':[srcFixer,hrefFormatter],'IMG':[srcFixer,delImageSrc],'CANVAS':[canvasToImgCoverter]};function hideSpottedEl(el){if(!this.excludeSelectorList)return el;if(el.nodeType!==Node.ELEMENT_NODE)return el;if(el.dataset.hasOwnProperty('ezprinthide'))el.style.display='none';return el}function removeInlineStyles(el){if(!this.removeInlineStyles)return el;if(el.nodeType!==Node.ELEMENT_NODE)return el;if(el.hasAttribute('style'))el.removeAttribute('style');return el}function hrefFormatter(el){if(el.childElementCount>0)return el;if(!this.exposeLinkUrls)return el;var f=function f(el,tpl){return tpl.replace('{title}',el.textContent).replace('{url}',el.href)};var srcEl=document.querySelector('*[data-ezprintid="'+el.dataset.ezprintid+'"]');switch(this.exposeLinkUrls.toLowerCase()){case'all':el.textContent=f(el,this.linkTextTemplate);break;case'external':if(this.hostname!==srcEl.hostname)el.textContent=f(el,this.linkTextTemplate);break;}return el}function srcFixer(el){var srcEl=document.querySelector('*[data-ezprintid="'+el.dataset.ezprintid+'"]');if(el.getAttribute('src'))el.setAttribute('src',srcEl.src);if(el.getAttribute('href'))el.setAttribute('href',srcEl.href);return el}function revealHiddenEl(el){if(!this.revealHiddenElements)return el;if(el.nodeType===Node.ELEMENT_NODE&&el.style.display==='none')el.style.display='';return el}function delImageSrc(el){if(!this.removeImages)return el;var srcEl=document.querySelector('*[data-ezprintid="'+el.dataset.ezprintid+'"]');el.setAttribute('width',srcEl.width);el.setAttribute('height',srcEl.height);el.alt='['+el.src+'] '+el.alt;el.src='';el.style.border='1px';el.style.borderStyle='solid';el.style.borderColor='black';return el}function redrawCanvas(el){if(!this.printCanvas)return el;var srcCanvas=document.querySelector('*[data-ezprintid="'+el.dataset.ezprintid+'"]');if(srcCanvas.isEqualNode(el))console.log('ezPrintJS: Successfully cloned canvas!');el.getContext('2d').drawImage(srcCanvas,0,0);return el}function canvasToImgCoverter(el){if(!this.printCanvas)return el;var srcCanvas=document.querySelector('*[data-ezprintid="'+el.dataset.ezprintid+'"]');var ctx=srcCanvas.getContext('2d');var png=srcCanvas.toDataURL('image/png');var doc=this.w.contentDocument||this.w.document;var image=doc.createElement('img');image.src=png;el.parentNode.appendChild(image);el.style.display='none';return el}function extendScrollable(el){if(!this.extendScrollableAreas)return el;if(el.nodeType!==Node.ELEMENT_NODE)return el;if(typeof this.extendScrollableAreas==='string'&&this.extendScrollableAreas!=='table')return el;var childNodeList=Array.from(el.childNodes);var isTableOnly=this.extendScrollableAreas==='table';if(isTableOnly&&childNodeList.length===0)return el;var isTableWrapped=childNodeList.some(function(childNode){return childNode.tagName&&childNode.tagName.toUpperCase()==='TABLE'});if(isTableOnly&&!isTableWrapped)return el;var srcEl=document.querySelector('*[data-ezprintid="'+el.dataset.ezprintid+'"]');if(srcEl.scrollHeight>srcEl.clientHeight)el.style.height=this.scrollableAreasMaxHeight?this.scrollableAreasMaxHeight+'px':srcEl.scrollHeight+'px';return el}function validateOptions(options){var appName='ezPrintJS';if(!options||toString.call(null,options)!==toString.call(null,{})||Object.keys(options).length===0)throw new Error(appName+': no options or invalid options passed! Please read docs before using '+appName);var allowedTypesMap={target:'string',printInIframe:'boolean',setPrintSize:'string',beforePrintCb:'function',afterPrintCb:'function',exposeLinkUrls:'string',linkTextTemplate:'string',keepSourceCSS:'boolean',watermarkImageURL:'string',watermarkOpacity:'number',headerText:'string',footerText:'string',revealHiddenElements:'boolean',printCanvas:'boolean',extendScrollableAreas:['boolean','string'],scrollableAreasMaxHeight:'number',excludeSelectorList:'array',removeInlineStyles:'boolean',removeImages:'boolean',injectCustomStyle:'string',customMethodMap:'object'};Object.keys(options).forEach(function(option){return allowedTypesMap.hasOwnProperty(option)?typeChecker('options.'+option,options[option],allowedTypesMap[option]):false});if(!options.target)throw new Error(appName+': no options.target is passed! This is required option!');if(!document.querySelector(options.target))throw new Error(appName+': element with selector \''+options.target+'\' is not exists or invalid selector passed!');var badHTMLTags=['LINK','TITLE','HEAD','META','BASE','BASEFONT','SCRIPT','STYLE','NOSCRIPT','APPLET'];if(badHTMLTags.includes(document.querySelector(options.target).tagName.toUpperCase()))throw new Error(appName+': target element should not be one of following type \''+badHTMLTags.join(', ').toLowerCase()+'\'!');if(options.exposeLinkUrls&&!['all','external'].includes(options.exposeLinkUrls.toLowerCase()))throw new Error(appName+': \'options.exposeLinkUrls\' should be set to \'all\' or \'external\'');if(options.watermarkOpacity>1||options.watermarkOpacity<0)throw new Error(appName+': \'options.exposeLinkUrls\' should be greater than 0 and lower than 1');if(options.customMethodMap){if(Object.keys(options.customMethodMap).length===0)throw new Error(appName+': \'options.customMethodMap\' should be non-empty object of arrays with tag handlers!');Object.keys(options.customMethodMap).forEach(function(tagName){typeChecker('options.customMethodMap.'+tagName,options.customMethodMap[tagName],'array');options.customMethodMap[tagName].forEach(function(fn,i){typeChecker('options.customMethodMap.'+tagName+'['+i+']',fn,'function');if(!fn.prototype)throw new TypeError(appName+': \'options.customMethodMap.'+tagName+'['+i+']\' should be regular js function, not ES6 fat arrow function!')})})}}function typeChecker(name,val,expectedType){var appName='ezPrintJS';var expType=Array.isArray(expectedType)?expectedType.join(' or '):expectedType;var type=expectedType==='array'?(typeof val==='undefined'?'undefined':_typeof(val))+' or empty array':typeof val==='undefined'?'undefined':_typeof(val);var check=function check(val,expectedType){if(expectedType==='array')return Array.isArray(val)&&val.length>0;if(expectedType==='number')return typeof val==='number'&&!Number.isNaN(val);if(Array.isArray(expectedType))return expectedType.some(function(type){return check(val,type)});return(typeof val==='undefined'?'undefined':_typeof(val))===expectedType};if(!check(val,expectedType))throw new TypeError(appName+': expected \''+name+'\' to be '+expType+', instead got '+type+'!')}function ezPrintJS(options){validateOptions(options);options.hostname=window.location.hostname;options.isIE=isIE();options.watermarkOpacity=options.watermarkOpacity||0.25;options.linkTextTemplate=options.linkTextTemplate||'{title} [{url}]';if(options.customMethodMap)importCustomMethods(tagHandlerMap,options.customMethodMap);options.beforePrintCb?options.beforePrintCb():function(){}();var targetNode=document.querySelector(options.target).tagName.toUpperCase()==='HTML'?document.querySelector('body'):document.querySelector(options.target);walkThruNodeList(targetNode,markSourceEl);if(options.excludeSelectorList)Array.from(document.querySelectorAll(options.excludeSelectorList.join(', '))).forEach(function(el){return el.dataset.ezprinthide='true'});var w=options.printInIframe?printInIframe():window.open();var doc=options.printInIframe?w.contentDocument||w.document:w.document;options.w=w;var nodeDoctype=doc.implementation.createDocumentType('html',' ',' ');if(doc.doctype)doc.replaceChild(nodeDoctype,doc.doctype);else doc.insertBefore(nodeDoctype,doc.childNodes[0]);enableImportNode(doc);var importNode=options.isIE?doc._importNode:doc.importNode.bind(doc);var wrapCloneIntoRoot=function wrapCloneIntoRoot(clone,root){root.appendChild(clone);return root};var clone=importNode(targetNode,true);walkThruNodeList(clone,callMethodsOnClonedEl(options));var dupeNode=clone.tagName.toUpperCase()==='BODY'?clone:wrapCloneIntoRoot(clone,doc.createElement('div'));w.window.onbeforeunload=options.afterPrintCb?options.afterPrintCb:function(){};if(options.setPrintSize)injectStyleTag(doc,'\n        @page {\n          size: '+options.setPrintSize+';\n          -webkit-print-color-adjust: exact;\n        }\n      ');if(options.keepSourceCSS)Array.from(document.querySelectorAll('head link[rel~="stylesheet"], style')).forEach(function(node){markSourceEl(node);srcFixer(node);var dupeNode=importNode(node,true);doc.head.appendChild(dupeNode);unMarkSourceEl(node)});if(options.watermarkImageURL){var watermarkDiv=doc.createElement('div');watermarkDiv.className='printWatermark';dupeNode.appendChild(watermarkDiv);var watermarkImage=new Image;watermarkImage.onload=function(){injectStyleTag(doc,'\n          .printWatermark:before {\n            content: url('+options.watermarkImageURL+');\n            opacity: '+options.watermarkOpacity+';\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            margin-top: -'+Math.ceil(watermarkImage.height/2)+'px;\n            margin-left: -'+Math.ceil(watermarkImage.width/2)+'px;\n          }\n        ');openPrintWindow(w)};watermarkImage.onerror=function(){injectStyleTag(doc,'\n          .printWatermark:before {\n            content: url('+options.watermarkImageURL+');\n            opacity: 0.25;\n            position: fixed;\n            top: 50%;\n            left: 50%;\n          }\n        ');openPrintWindow(w)};watermarkImage.src=options.watermarkImageURL}insertDOM(doc,dupeNode,options);if(options.headerText||options.footerText){var rootSelector=dupeNode.tagName.toUpperCase()==='BODY'?'body':'body > div';injectStyleTag(doc,'\n        '+rootSelector+' > *:not(.printableHeader):not(.printableFooter) {\n          '+(options.headerText?'margin-top: 30px;':'/**/')+'\n          '+(options.footerText?'margin-bottom: 10px;':'/**/')+'\n        }\n      ')}if(options.injectCustomStyle)injectStyleTag(doc,options.injectCustomStyle);dupeNode.tagName.toUpperCase()==='BODY'?doc.querySelector('html').replaceChild(dupeNode,doc.body):doc.body.appendChild(dupeNode);walkThruNodeList(targetNode,unMarkSourceEl);if(!options.watermarkImageURL)openPrintWindow(options)}function printInIframe(){var iframe=document.createElement('iframe');iframe.id='ezPrintJSFrame';iframe.name='ezPrintJSFrame';iframe.style.width=1;iframe.style.height=1;iframe.style.visibility='hidden';document.body.appendChild(iframe);var frameWin=iframe.contentWindow||iframe;var doc=frameWin.contentDocument||frameWin.document;frameWin.focus();doc.open();doc.close();return frameWin}function openPrintWindow(options){var printIframe=function printIframe(){var iframe=document.getElementById(options.w.name);var print=options.w.document.execCommand('print',false,null);if(!print)options.w.window.print();document.body.removeChild(iframe)};setTimeout(function(){if(options.printInIframe)return printIframe();options.w.window.print();options.w.window.close()},550)}function walkThruNodeList(nodeList,cb){if(nodeList.childNodes.length===0)return cb(nodeList);Array.from(nodeList.childNodes).forEach(function(el){if(el.childNodes.length>0)walkThruNodeList(el,cb);cb(el)})}function importCustomMethods(srcMethodMap,newMethodMap){Object.keys(newMethodMap).forEach(function(tagName){var _srcMethodMap$TN;var TN=tagName.toUpperCase();if(srcMethodMap.hasOwnProperty(TN))return(_srcMethodMap$TN=srcMethodMap[TN]).push.apply(_srcMethodMap$TN,_toConsumableArray(newMethodMap[tagName]));srcMethodMap[TN]=newMethodMap[tagName]})}function callMethodsOnClonedEl(options){return function(el){if(el.nodeType===Node.ELEMENT_NODE&&tagHandlerMap.hasOwnProperty(el.tagName.toUpperCase()))tagHandlerMap[el.tagName.toUpperCase()].reduce(function(arg,fn){return fn.bind(options)(arg)},el);tagHandlerMap['*'].reduce(function(arg,fn){return fn.bind(options)(arg)},el)}}function markSourceEl(el,isRemoveFlag){var regularPrefix='ezprintid';var pseudoGuid=function pseudoGuid(){var fourChars=function fourChars(){return((1+Math.random())*65536|0).toString(16).substring(1).toUpperCase()};return fourChars()+fourChars()+'-'+fourChars()+'-'+fourChars()+'-'+fourChars()+'-'+fourChars()+fourChars()+fourChars()};if(el.nodeType!==Node.ELEMENT_NODE)return;if(isRemoveFlag)return delete el.dataset[regularPrefix];el.dataset[regularPrefix]=pseudoGuid()}function unMarkSourceEl(el){return markSourceEl(el,true)}function injectStyleTag(doc,cssString){var style=doc.createElement('style');style.type='text/css';if(style.styleSheet)style.styleSheet.cssText=cssString;else style.appendChild(doc.createTextNode(cssString));doc.head.appendChild(style)}function insertDOM(doc,DOMNode,options){var attach=function attach(cName,text,isBelow){var wrapperDiv=doc.createElement('div');var innerText=doc.createTextNode(text);wrapperDiv.className=cName;isBelow?(wrapperDiv.appendChild(innerText),wrapperDiv.appendChild(doc.createElement('hr'))):(wrapperDiv.appendChild(doc.createElement('hr')),wrapperDiv.appendChild(innerText));DOMNode.appendChild(wrapperDiv)};injectStyleTag(doc,'\n      .printableHeader {\n        position: fixed;\n        top: 0px;\n        width: 100%;\n      }\n      .printableFooter {\n        position: fixed;\n        bottom: 0px;\n        width: 100%;\n      }\n    ');if(options.headerText)attach('printableHeader',options.headerText,true);if(options.footerText)attach('printableFooter',options.footerText,false)}window.ezPrintJS=ezPrintJS;window.ezCtrlP=ezCtrlP})(window,document);
